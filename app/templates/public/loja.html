{% extends "public/base.html" %}

{% block title %}Loja Solidária - Doce Esperança{% endblock %}

{% block content %}
  <div class="loja-hero text-center mb-5">
    <span class="badge bg-light text-primary fw-semibold px-3 py-2 mb-3">Loja Solidária</span>
    <h1 class="display-6 fw-bold mb-3">Transforme suas compras em esperança</h1>
    <p class="lead text-muted mb-0">Cada produto disponível aqui foi feito com carinho e toda a arrecadação fortalece os projetos sociais da Doce Esperança.</p>
  </div>

  {% if produtos %}
    <div class="store-grid">
      {% for produto in produtos %}
        {% set detalhe_url = url_for('public.loja_produto', slug=produto.slug, produto_id=produto.id) if produto.id else None %}
        <article class="store-card card border-0 shadow-sm h-100">
          {% if detalhe_url %}
            <a class="store-card__media d-block" href="{{ detalhe_url }}" aria-label="Ver detalhes de {{ produto.nome }}">
              {% if produto.imagem %}
                <img src="{{ static_url(produto.imagem) }}" alt="{{ produto.nome }}" class="store-card__image">
              {% else %}
                <div class="store-card__placeholder">
                  <i class="bi bi-image"></i>
                </div>
              {% endif %}
            </a>
          {% else %}
            <div class="store-card__media">
              {% if produto.imagem %}
                <img src="{{ static_url(produto.imagem) }}" alt="{{ produto.nome }}" class="store-card__image">
              {% else %}
                <div class="store-card__placeholder">
                  <i class="bi bi-image"></i>
                </div>
              {% endif %}
            </div>
          {% endif %}
          <div class="card-body d-flex flex-column position-relative">
            <h2 class="h5 fw-bold">
              {% if detalhe_url %}
                <a class="store-card__title" href="{{ detalhe_url }}">{{ produto.nome }}</a>
              {% else %}
                <span class="store-card__title">{{ produto.nome }}</span>
              {% endif %}
            </h2>
            <p class="mb-3 text-muted">{{ produto.descricao }}</p>
            <div class="mt-auto">
              <div class="store-card__price mb-2">{{ produto.preco_formatado }}</div>
              <div class="store-card__frete text-muted mb-3">Frete estimado: <strong>{{ produto.frete_formatado }}</strong></div>
              <div class="d-grid gap-2">
                {% if detalhe_url %}
                  <a class="btn btn-outline-primary" href="{{ detalhe_url }}">
                    <i class="bi bi-eye me-1"></i>Ver detalhes
                  </a>
                {% else %}
                  <button type="button" class="btn btn-outline-primary" disabled>
                    <i class="bi bi-eye me-1"></i>Ver detalhes
                  </button>
                {% endif %}
                <button
                  type="button"
                  class="btn btn-store"
                  data-pix-button
                  data-product-name="{{ produto.nome|e }}"
                  data-product-price="{{ '%.2f'|format(produto.preco) }}"
                  data-product-frete="{{ '%.2f'|format(produto.frete) }}"
                >
                  <i class="bi bi-qr-code me-2"></i>Comprar via Pix
                </button>
              </div>
            </div>
          </div>
        </article>
      {% endfor %}
    </div>
  {% else %}
    <div class="text-center text-muted py-5">
      <i class="bi bi-bag fs-1 d-block mb-3"></i>
      <p class="lead">Em breve novos produtos estarão disponíveis em nossa Loja Solidária.</p>
    </div>
  {% endif %}

  {% include "public/partials/_pix_modal.html" %}
{% endblock %}
