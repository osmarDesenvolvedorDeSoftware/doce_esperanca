{% extends "public/base.html" %}

{% block title %}Loja Solidária - Doce Esperança{% endblock %}

{% block content %}
  <div class="loja-container" role="region" aria-labelledby="loja-hero-heading">
    <header class="loja-hero text-center mb-5" aria-label="Apresentação da Loja Solidária">
      <span class="badge bg-light text-primary fw-semibold px-3 py-2 mb-3">Loja Solidária</span>
      <h1 id="loja-hero-heading" class="display-6 fw-bold mb-3">Transforme suas compras em esperança</h1>
      <p class="lead text-muted mb-0">Cada produto disponível aqui foi feito com carinho e toda a arrecadação fortalece os projetos sociais da Doce Esperança.</p>
    </header>

    {% if produtos %}
      <section class="vitrine-section" role="region" aria-label="Lista de produtos disponíveis">
        <div class="vitrine" role="list">
          {% for produto in produtos %}
          {% set detalhe_url = url_for('public.loja_produto', slug=produto.slug, produto_id=produto.id) if produto.id else None %}
          <article class="produto-card" role="listitem" aria-labelledby="produto-{{ loop.index }}-titulo">
            {% if detalhe_url %}
              <a class="produto-media" href="{{ detalhe_url }}" aria-label="Ver detalhes de {{ produto.nome }}">
                {% if produto.imagem %}
                  <img src="{{ static_url(produto.imagem) }}" alt="Produto solidário: {{ produto.nome }}" class="produto-img">
                {% else %}
                  <div class="produto-placeholder" role="img" aria-label="Imagem do produto indisponível">
                    <i class="bi bi-image" aria-hidden="true"></i>
                  </div>
                {% endif %}
              </a>
            {% else %}
              <div class="produto-media">
                {% if produto.imagem %}
                  <img src="{{ static_url(produto.imagem) }}" alt="Produto solidário: {{ produto.nome }}" class="produto-img">
                {% else %}
                  <div class="produto-placeholder" role="img" aria-label="Imagem do produto indisponível">
                    <i class="bi bi-image" aria-hidden="true"></i>
                  </div>
                {% endif %}
              </div>
            {% endif %}
            <div class="produto-info">
              <h2 id="produto-{{ loop.index }}-titulo" class="produto-titulo">
                {% if detalhe_url %}
                  <a class="produto-link" href="{{ detalhe_url }}">{{ produto.nome }}</a>
                {% else %}
                  <span class="produto-link">{{ produto.nome }}</span>
                {% endif %}
              </h2>
              <p class="produto-descricao">{{ produto.descricao }}</p>
              <div class="produto-preco">{{ produto.preco_formatado }}</div>
              <p class="produto-frete">Frete estimado: <strong>{{ produto.frete_formatado }}</strong></p>
              <div class="produto-acoes">
                {% if detalhe_url %}
                  <a class="btn btn-detalhes" href="{{ detalhe_url }}" aria-label="Ver detalhes completos de {{ produto.nome }}">
                    <i class="bi bi-eye me-1"></i>Ver detalhes
                  </a>
                {% else %}
                  <button type="button" class="btn btn-detalhes" disabled>
                    <i class="bi bi-eye me-1"></i>Ver detalhes
                  </button>
                {% endif %}
                <button
                  type="button"
                  class="btn btn-comprar"
                  data-pix-button
                  data-product-name="{{ produto.nome|e }}"
                  data-product-price="{{ '%.2f'|format(produto.preco) }}"
                  data-product-frete="{{ '%.2f'|format(produto.frete) }}"
                  aria-label="Comprar {{ produto.nome }} via Pix"
                >
                  <i class="bi bi-qr-code me-2"></i>Comprar via Pix
                </button>
              </div>
            </div>
          </article>
          {% endfor %}
        </div>
      </section>
    {% else %}
      <div class="text-center text-muted py-5" role="region" aria-live="polite" aria-label="Aviso sobre disponibilidade de produtos">
        <i class="bi bi-bag fs-1 d-block mb-3" aria-hidden="true"></i>
        <p class="lead">Em breve novos produtos estarão disponíveis em nossa Loja Solidária.</p>
      </div>
    {% endif %}
  </div>

  {% include "public/partials/_pix_modal.html" %}
{% endblock %}
